npm warn Unknown cli config "--testNamePattern". This will stop working in the next major version of npm.

> neural-ticker-core@0.2.0 test
> jest

PASS src/modules/tickers/tickers.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/health/health.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/users/admin.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 18732  - 13. 12. 2025 21:42:20   ERROR [MarketDataService] Failed to refresh data for AAPL: this.finnhubService.getBasicFinancials is not a function
FAIL src/modules/market-data/market-data.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

  ΓùÅ MarketDataService ΓÇ║ getSnapshot ΓÇ║ should fetch from Finnhub if cached price is stale

    expect(received).toBe(expected) // Object.is equality

    Expected: 155
    Received: 100

      235 |
      236 |       expect(finnhubService.getQuote).toHaveBeenCalledWith('AAPL');
    > 237 |       expect(result.latestPrice!.close).toBe(155);
          |                                         ^
      238 |       expect(mockOhlcvRepo.save).toHaveBeenCalled();
      239 |     });
      240 |   });

      at Object.<anonymous> (modules/market-data/market-data.service.spec.ts:237:41)

PASS src/modules/jobs/jobs.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 4924  - 13. 12. 2025 21:42:21   ERROR [JobsService] Failed to sync FAIL: Sync failed
(node:3044) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/modules/auth/auth.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 4924  - 13. 12. 2025 21:42:21   ERROR [JobsService] Daily candle sync failed globally
[Nest] 4924  - 13. 12. 2025 21:42:21   ERROR [JobsService] Error: Global fail
    at Object.<anonymous> (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\jobs\jobs.service.spec.ts:82:9)
    at Promise.finally.completed (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
    at _callCircusTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at run (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
    at runAndTransformResultsToJestFormat (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
    at jestAdapter (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/modules/tickers/ticker-detail.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

    console.error
      Error getting snapshot for INVALID: Error: Ticker not found
          at Object.<anonymous> (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\tickers\ticker-detail.controller.spec.ts:111:9)
          at Promise.finally.completed (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
          at _callCircusTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
          at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
          at run (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
          at jestAdapter (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\runner.js:101:19)
          at runTestInternal (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:275:16)
          at runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:343:7)
          at Object.worker (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:497:12)

      38 |       snapshot = await this.marketDataService.getSnapshot(symbol);
      39 |     } catch (e) {
    > 40 |       console.error(`Error getting snapshot for ${symbol}:`, e);
         |               ^
      41 |       throw new NotFoundException(`Ticker ${symbol} not found`);
      42 |     }
      43 |

      at TickerDetailController.getCompositeData (modules/tickers/ticker-detail.controller.ts:40:15)
      at Object.<anonymous> (modules/tickers/ticker-detail.controller.spec.ts:114:7)

PASS src/modules/jobs/jobs.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

FAIL src/modules/research/research.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

  ΓùÅ ResearchService ΓÇ║ should be defined

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createResearchTicket ΓÇ║ should create and save a PENDING research note

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createResearchTicket ΓÇ║ should default to gemini provider and deep quality

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createManualNote ΓÇ║ should create a manual note with COMPLETED status

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ getResearchNote ΓÇ║ should return a note by id

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ getResearchNote ΓÇ║ should return null if not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ deleteResearchNote ΓÇ║ should delete note by id

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ findAll ΓÇ║ should return paginated results

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ findAll ΓÇ║ should filter by status when not "all"

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ failStuckTickets ΓÇ║ should mark stuck tickets as failed

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ failStuckTickets ΓÇ║ should return 0 if no stuck tickets

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should update title for owner

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should update title for admin

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should throw if note not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should throw if unauthorized

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ processTicket ΓÇ║ should return early if note not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

(node:20592) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/modules/users/users.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

FAIL src/modules/research/research.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

      at _log (../node_modules/dotenv/lib/main.js:142:11)

  ΓùÅ ResearchController ΓÇ║ delete ΓÇ║ should delete research note

    TypeError: Cannot read properties of undefined (reading 'id')

      322 |   @Delete(':id')
      323 |   async delete(@Request() req: any, @Param('id') id: string) {
    > 324 |     const userId = req.user.id;
          |                             ^
      325 |     // Optional: Check if exists first or just delete
      326 |     // Service now handles permission checking
      327 |     await this.researchService.deleteResearchNote(id, userId);

      at ResearchController.delete (modules/research/research.controller.ts:324:29)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:158:45)

  ΓùÅ ResearchController ΓÇ║ delete ΓÇ║ should throw NotFoundException if not found

    expect(received).rejects.toThrow(expected)

    Expected constructor: NotFoundException
    Received constructor: TypeError

    Received message: "Cannot read properties of undefined (reading 'id')"

          322 |   @Delete(':id')
          323 |   async delete(@Request() req: any, @Param('id') id: string) {
        > 324 |     const userId = req.user.id;
              |                             ^
          325 |     // Optional: Check if exists first or just delete
          326 |     // Service now handles permission checking
          327 |     await this.researchService.deleteResearchNote(id, userId);

      at ResearchController.delete (modules/research/research.controller.ts:324:29)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:167:37)
      at Object.toThrow (../node_modules/expect/build/index.js:2155:20)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:167:54)

PASS src/modules/users/users.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

(node:21132) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/modules/auth/auth.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/stocktwits/stocktwits.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 3044  - 13. 12. 2025 21:42:21   ERROR [TickersService] Finnhub fetch failed for UNKNOWN: API error
[Nest] 3044  - 13. 12. 2025 21:42:21   ERROR [TickersService] Failed to download logo from https://logo.com/aapl.png: Cannot read properties of undefined (reading 'subscribe')
[Nest] 3044  - 13. 12. 2025 21:42:21   ERROR [TickersService] Finnhub fetch failed for TEST: Network error
[Nest] 3044  - 13. 12. 2025 21:42:21   ERROR [TickersService] Failed to download logo from https://bad.com: Network error
[Nest] 5368  - 13. 12. 2025 21:42:21   ERROR [RiskRewardService] Failed to generate analysis for INVALID from note note-1: Ticker not found
PASS src/modules/market-data/market-data.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/watchlist/watchlist.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (../node_modules/dotenv/lib/main.js:142:11)

    console.log
      DEBUG: createWatchlist req.user: { id: 'user-1', uid: 'user-1' }

      at WatchlistController.createWatchlist (modules/watchlist/watchlist.controller.ts:67:13)

PASS src/modules/tickers/tickers.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 11200  - 13. 12. 2025 21:42:22   ERROR [StockTwitsService] Failed to fetch posts for AAPL: Network error
PASS src/modules/risk-reward/risk-reward.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 11200  - 13. 12. 2025 21:42:22   ERROR [StockTwitsService] Failed to track watchers for AAPL: Network error
PASS src/modules/risk-reward/risk-reward.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/stocktwits/stocktwits.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/social/social.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/auth/guards/google-auth.guard.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

    console.log
      [GoogleAuthGuard] Generated Options: { callbackURL: 'https://example.com/callback', state: undefined }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

    console.log
      [GoogleAuthGuard] Generated Options: {
        callbackURL: 'https://myapp.com/api/auth/google/callback',
        state: undefined
      }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

    console.log
      [GoogleAuthGuard] Generated Options: {
        callbackURL: 'https://example.com/callback',
        state: '{"intent":"waitlist"}'
      }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

    console.log
      [GoogleAuthGuard] Generated Options: { callbackURL: 'https://example.com/callback', state: undefined }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

    console.log
      [GoogleAuthGuard] Generated Options: {
        callbackURL: 'https://myapp.com/api/auth/google/callback',
        state: undefined
      }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

    console.log
      [GoogleAuthGuard] Generated Options: {
        callbackURL: 'http://localhost:3000/api/auth/google/callback',
        state: undefined
      }

      at GoogleAuthGuard.getAuthenticateOptions (modules/auth/guards/google-auth.guard.ts:111:13)

[Nest] 4924  - 13. 12. 2025 21:42:22   ERROR [FinnhubService] Unexpected Error [AAPL]: undefined
[Nest] 4924  - 13. 12. 2025 21:42:22   ERROR [FinnhubService] Unexpected Error [AAPL]: Network error
PASS src/modules/social/social.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 4924  - 13. 12. 2025 21:42:22   ERROR [FinnhubService] Finnhub API Error [AAPL]: 403 - "Forbidden"
PASS src/modules/finnhub/finnhub.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/app.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 5368  - 13. 12. 2025 21:42:22   ERROR [OpenAiProvider] OpenAI call failed: Rate limit exceeded
[Nest] 9616  - 13. 12. 2025 21:42:22   ERROR [GoogleAuthExceptionFilter] Google Auth Failed: User test@example.com is not on the invite list
[Nest] 9616  - 13. 12. 2025 21:42:22   ERROR [GoogleAuthExceptionFilter] Google Auth Failed: Some other authentication error
[Nest] 9616  - 13. 12. 2025 21:42:22   ERROR [GoogleAuthExceptionFilter] Google Auth Failed: string error
[Nest] 9616  - 13. 12. 2025 21:42:22   ERROR [GoogleAuthExceptionFilter] Google Auth Failed: Auth error
PASS src/modules/auth/filters/google-auth-exception.filter.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/llm/providers/openai.provider.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 3044  - 13. 12. 2025 21:42:22   ERROR [ProxyController] Failed to proxy image: https://evil.com/image.png
[Nest] 3044  - 13. 12. 2025 21:42:22   ERROR [ProxyController] BadRequestException: Only finnhub.io images are allowed
    at ProxyController.proxyImage (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\proxy\proxy.controller.ts:38:15)
    at Object.<anonymous> (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\proxy\proxy.controller.spec.ts:55:24)
    at Promise.finally.completed (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
    at _callCircusTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at run (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
    at runAndTransformResultsToJestFormat (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
    at jestAdapter (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:497:12) {
  response: {
    message: 'Only finnhub.io images are allowed',
    error: 'Bad Request',
    statusCode: 400
  },
  status: 400,
  options: {}
}
[Nest] 3044  - 13. 12. 2025 21:42:22   ERROR [ProxyController] Failed to proxy image: https://static.finnhub.io/logo/aapl.png
[Nest] 3044  - 13. 12. 2025 21:42:22   ERROR [ProxyController] Error: Network Error
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\proxy\proxy.controller.spec.ts:95:26
    at Observable.init [as _subscribe] (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\observable\throwError.ts:123:68)
    at Observable._trySubscribe (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\Observable.ts:235:19)
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\Observable.ts:225:18
    at Object.errorContext (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\util\errorContext.ts:29:5)
    at Observable.subscribe (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\Observable.ts:211:5)
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\firstValueFrom.ts:73:12
    at new Promise (<anonymous>)
    at firstValueFrom (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\rxjs\src\internal\firstValueFrom.ts:58:10)
    at ProxyController.proxyImage (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\proxy\proxy.controller.ts:43:44)
    at Object.<anonymous> (C:\Users\brani\Documents\GitHub\neural-ticker-core\src\modules\proxy\proxy.controller.spec.ts:104:24)
    at Promise.finally.completed (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
    at _callCircusTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
    at C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at _runTestsForDescribeBlock (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
    at run (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
    at runAndTransformResultsToJestFormat (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
    at jestAdapter (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\brani\Documents\GitHub\neural-ticker-core\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/modules/proxy/proxy.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/common/transformers/column-numeric.transformer.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/watchlist/watchlist.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/llm/llm.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/market-data/market-data-bulk.controller.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/users/nickname-generator.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/auth/guards/roles.guard.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/llm/providers/gemini.provider.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[Nest] 4924  - 13. 12. 2025 21:42:22   ERROR [FirebaseService] [FATAL] Invalid Firebase Credentials! Missing private_key or client_email. Found keys: client_email
PASS src/modules/firebase/firebase.service.spec.ts
  ΓùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (15) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

(node:9616) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)

Summary of all failing tests
FAIL modules/market-data/market-data.service.spec.ts
  ΓùÅ MarketDataService ΓÇ║ getSnapshot ΓÇ║ should fetch from Finnhub if cached price is stale

    expect(received).toBe(expected) // Object.is equality

    Expected: 155
    Received: 100

      235 |
      236 |       expect(finnhubService.getQuote).toHaveBeenCalledWith('AAPL');
    > 237 |       expect(result.latestPrice!.close).toBe(155);
          |                                         ^
      238 |       expect(mockOhlcvRepo.save).toHaveBeenCalled();
      239 |     });
      240 |   });

      at Object.<anonymous> (modules/market-data/market-data.service.spec.ts:237:41)

FAIL modules/research/research.service.spec.ts
  ΓùÅ ResearchService ΓÇ║ should be defined

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createResearchTicket ΓÇ║ should create and save a PENDING research note

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createResearchTicket ΓÇ║ should default to gemini provider and deep quality

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ createManualNote ΓÇ║ should create a manual note with COMPLETED status

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ getResearchNote ΓÇ║ should return a note by id

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ getResearchNote ΓÇ║ should return null if not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ deleteResearchNote ΓÇ║ should delete note by id

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ findAll ΓÇ║ should return paginated results

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ findAll ΓÇ║ should filter by status when not "all"

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ failStuckTickets ΓÇ║ should mark stuck tickets as failed

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ failStuckTickets ΓÇ║ should return 0 if no stuck tickets

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should update title for owner

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should update title for admin

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should throw if note not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ updateTitle ΓÇ║ should throw if unauthorized

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

  ΓùÅ ResearchService ΓÇ║ processTicket ΓÇ║ should return early if note not found

    Nest can't resolve dependencies of the ResearchService (ResearchNoteRepository, LlmService, MarketDataService, UsersService, RiskRewardService, ConfigService, ?). Please make sure that the argument NotificationsService at index [6] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsService is a provider, is it part of the current RootTestModule?
    - If NotificationsService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsService */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      53 |
      54 |   beforeEach(async () => {
    > 55 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      56 |       providers: [
      57 |         ResearchService,
      58 |         { provide: getRepositoryToken(ResearchNote), useValue: mockRepo },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 6)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/research/research.service.spec.ts:55:35)

FAIL modules/research/research.controller.spec.ts
  ΓùÅ ResearchController ΓÇ║ delete ΓÇ║ should delete research note

    TypeError: Cannot read properties of undefined (reading 'id')

      322 |   @Delete(':id')
      323 |   async delete(@Request() req: any, @Param('id') id: string) {
    > 324 |     const userId = req.user.id;
          |                             ^
      325 |     // Optional: Check if exists first or just delete
      326 |     // Service now handles permission checking
      327 |     await this.researchService.deleteResearchNote(id, userId);

      at ResearchController.delete (modules/research/research.controller.ts:324:29)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:158:45)

  ΓùÅ ResearchController ΓÇ║ delete ΓÇ║ should throw NotFoundException if not found

    expect(received).rejects.toThrow(expected)

    Expected constructor: NotFoundException
    Received constructor: TypeError

    Received message: "Cannot read properties of undefined (reading 'id')"

          322 |   @Delete(':id')
          323 |   async delete(@Request() req: any, @Param('id') id: string) {
        > 324 |     const userId = req.user.id;
              |                             ^
          325 |     // Optional: Check if exists first or just delete
          326 |     // Service now handles permission checking
          327 |     await this.researchService.deleteResearchNote(id, userId);

      at ResearchController.delete (modules/research/research.controller.ts:324:29)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:167:37)
      at Object.toThrow (../node_modules/expect/build/index.js:2155:20)
      at Object.<anonymous> (modules/research/research.controller.spec.ts:167:54)


Test Suites: 3 failed, 1 skipped, 33 passed, 36 of 37 total
Tests:       19 failed, 1 skipped, 286 passed, 306 total
Snapshots:   0 total
Time:        5.98 s
Ran all test suites.
