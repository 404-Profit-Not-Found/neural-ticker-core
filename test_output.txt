
> neural-ticker-core@0.0.3 test
> jest

PASS src/modules/market-data/market-data.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/risk-reward/risk-reward.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/llm/providers/gemini.provider.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[31m[Nest] 52472  - [39m12/10/2025, 8:44:44 PM [31m  ERROR[39m [38;5;3m[OpenAiProvider] [39m[31mOpenAI call failed: Rate limit exceeded[39m
PASS src/modules/llm/providers/openai.provider.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/watchlist/watchlist.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/auth/auth.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/research/research.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/stocktwits/stocktwits.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/risk-reward/risk-reward.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/common/transformers/column-numeric.transformer.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

FAIL src/modules/users/users.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

  ‚óè UsersService ‚Ä∫ should be defined

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ createOrUpdateGoogleUser ‚Ä∫ should update existing user

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ createOrUpdateGoogleUser ‚Ä∫ should create new user if not found

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ updatePreferences ‚Ä∫ should update preferences JSON

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ updatePreferences ‚Ä∫ should throw NotFoundException if user missing

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

PASS src/modules/finnhub/finnhub.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/tickers/tickers.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/market-data/market-data-bulk.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/watchlist/watchlist.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../node_modules/dotenv/lib/main.js:142:11)

    console.log
      DEBUG: createWatchlist req.user: { id: 'user-1', uid: 'user-1' }

      at WatchlistController.createWatchlist (modules/watchlist/watchlist.controller.ts:67:13)

PASS src/modules/market-data/market-data.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[31m[Nest] 52468  - [39m12/10/2025, 8:44:45 PM [31m  ERROR[39m [38;5;3m[FirebaseService] [39m[31m[FATAL] Invalid Firebase Credentials! Missing private_key or client_email. Found keys: client_email[39m
PASS src/modules/firebase/firebase.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/app.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

FAIL src/modules/auth/auth.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)

  ‚óè AuthService ‚Ä∫ validateOAuthLogin ‚Ä∫ should return user from UsersService

    TypeError: this.usersService.isEmailAllowed is not a function

      35 |
      36 |     // Access Control: Check Whitelist
    > 37 |     const isAllowed = await this.usersService.isEmailAllowed(email);
         |                                               ^
      38 |     if (!isAllowed) {
      39 |       this.logger.warn(
      40 |         `Login attempt blocked for non-whitelisted email: ${email}`,

      at AuthService.validateOAuthLogin (modules/auth/auth.service.ts:37:47)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:82:36)

PASS src/modules/users/users.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (../node_modules/dotenv/lib/main.js:142:11)

PASS src/modules/llm/llm.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../node_modules/dotenv/lib/main.js:142:11)

[31m[Nest] 52472  - [39m12/10/2025, 8:44:45 PM [31m  ERROR[39m [38;5;3m[JobsService] [39m[31mFailed to sync FAIL: Sync failed[39m
[31m[Nest] 52472  - [39m12/10/2025, 8:44:45 PM [31m  ERROR[39m [38;5;3m[JobsService] [39m[31mDaily candle sync failed globally[39m
[31m[Nest] 52472  - [39m12/10/2025, 8:44:45 PM [31m  ERROR[39m [38;5;3m[JobsService] [39mError: Global fail
    at Object.<anonymous> [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39msrc/modules/jobs/jobs.service.spec.ts:79:9[90m)[39m
    at Promise.finally.completed [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1557:28[90m)[39m
    at new Promise (<anonymous>)
    at callAsyncCircusFn [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1497:10[90m)[39m
    at _callCircusTest [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1007:40[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at _runTest [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:947:3[90m)[39m
    at [90m/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:862:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at run [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:761:3[90m)[39m
    at runAndTransformResultsToJestFormat [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1918:21[90m)[39m
    at jestAdapter [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-circus[24m/build/runner.js:101:19[90m)[39m
    at runTestInternal [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:275:16[90m)[39m
    at runTest [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:343:7[90m)[39m
    at Object.worker [90m(/Users/branislavlang/Documents/GitHub/neural-ticket-core/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:497:12[90m)[39m
PASS src/modules/jobs/jobs.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (35) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../node_modules/dotenv/lib/main.js:142:11)


Summary of all failing tests
FAIL modules/users/users.service.spec.ts
  ‚óè UsersService ‚Ä∫ should be defined

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ createOrUpdateGoogleUser ‚Ä∫ should update existing user

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ createOrUpdateGoogleUser ‚Ä∫ should create new user if not found

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ updatePreferences ‚Ä∫ should update preferences JSON

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

  ‚óè UsersService ‚Ä∫ updatePreferences ‚Ä∫ should throw NotFoundException if user missing

    Nest can't resolve dependencies of the UsersService (NicknameGeneratorService, UserRepository, ?). Please make sure that the argument "AllowedUserRepository" at index [2] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If "AllowedUserRepository" is a provider, is it part of the current RootTestModule?
    - If "AllowedUserRepository" is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing "AllowedUserRepository" */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

      23 |
      24 |   beforeEach(async () => {
    > 25 |     const module: TestingModule = await Test.createTestingModule({
         |                                   ^
      26 |       providers: [
      27 |         UsersService,
      28 |         {

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:286:19)
      at TestingInjector.resolveComponentWrapper (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 2)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:103:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/users/users.service.spec.ts:25:35)

FAIL modules/auth/auth.service.spec.ts
  ‚óè AuthService ‚Ä∫ validateOAuthLogin ‚Ä∫ should return user from UsersService

    TypeError: this.usersService.isEmailAllowed is not a function

      35 |
      36 |     // Access Control: Check Whitelist
    > 37 |     const isAllowed = await this.usersService.isEmailAllowed(email);
         |                                               ^
      38 |     if (!isAllowed) {
      39 |       this.logger.warn(
      40 |         `Login attempt blocked for non-whitelisted email: ${email}`,

      at AuthService.validateOAuthLogin (modules/auth/auth.service.ts:37:47)
      at Object.<anonymous> (modules/auth/auth.service.spec.ts:82:36)


Test Suites: 2 failed, 1 skipped, 20 passed, 22 of 23 total
Tests:       6 failed, 1 skipped, 94 passed, 101 total
Snapshots:   0 total
Time:        2.187 s, estimated 27 s
Ran all test suites.
